#######################
##  Disaster events  ##
#######################

namespace = cal_disaster

######################
##  Message events  ##
######################

country_event = {#start of the disaster
	id = cal_disaster.1
	title = cal_disaster.1.t
	desc = cal_disaster.1.d
	picture = RELIGIOUS_TURMOIL_eventPicture

	is_triggered_only = yes

	major = yes

	immediate = {
		set_country_flag = cal_has_illegimitate_caliph
		random_owned_province = {
			limit = {
				NOT = { has_province_flag = cal_disaster_spawn_rebels_here }
				NOT = { units_in_province = 1 }
				is_capital = no
			}
			set_province_flag = cal_disaster_spawn_rebels_here
		}
		if = {
			limit = {
				num_of_cities = 30
			}
			random_owned_province = {
				limit = {
					NOT = { has_province_flag = cal_disaster_spawn_rebels_here }
					NOT = { units_in_province = 1 }
					is_capital = no
				}
				set_province_flag = cal_disaster_spawn_rebels_here
			}
		}

	}

	option = { #caliphate
		name = cal_disaster.1.a

		set_country_flag = cal_caliphate_fight

		random_owned_province = {
			limit = {
				has_province_flag = cal_disaster_spawn_rebels_here
			}
			spawn_rebels = {
				type = pretender_rebels
				size = 3
			}
			clr_province_flag = cal_disaster_spawn_rebels_here
		}
		if = {
			limit = {
				any_owned_province = {
					has_province_flag = cal_disaster_spawn_rebels_here
				}
			}
			random_owned_province = {
				limit = {
					has_province_flag = cal_disaster_spawn_rebels_here
				}
				spawn_rebels = {
					type = pretender_rebels
					size = 2
				}
				clr_province_flag = cal_disaster_spawn_rebels_here
			}
		}

		add_disaster_modifier = {
			name = "cal_disaster_harsh"
			duration = -1
			disaster = cal_illegitimate_caliph
		}
	}

	option = { #abandon caliphate, become atheist
		name = cal_disaster.1.b

		set_country_flag = cal_atheist_state

		random_owned_province = {
			limit = {
				has_province_flag = cal_disaster_spawn_rebels_here
			}
			spawn_rebels = {
				type = pretender_rebels
				use_monarch_as_leader = yes
				size = 3
			}
			clr_province_flag = cal_disaster_spawn_rebels_here
		}
		if = {
			limit = {
				any_owned_province = {
					has_province_flag = cal_disaster_spawn_rebels_here
				}
			}
			random_owned_province = {
				limit = {
					has_province_flag = cal_disaster_spawn_rebels_here
				}
				spawn_rebels = {
					type = pretender_rebels
					size = 2
				}
				clr_province_flag = cal_disaster_spawn_rebels_here
			}
		}

		if = {
			limit = {
				NOT = { government = republic }
			}
			change_government_to_republic = yes
		}
		add_government_reform = cal_atheist_republic_reform


		if = {
			limit = {
				has_country_modifier = cal_caliphate
			}
			remove_country_modifier = cal_caliphate
		}
		if = {
			limit = {
				has_country_modifier = cal_caliphate_sunni
			}
			remove_country_modifier = cal_caliphate_sunni
		}
		if = {
			limit = {
				has_country_modifier = cal_caliphate_shia
			}
			remove_country_modifier = cal_caliphate_shia
		}
		if = {
			limit = {
				has_country_modifier = cal_caliphate_ibadi
			}
			remove_country_modifier = cal_caliphate_ibadi
		}
	}
}

country_event = { #order restored
	id = cal_disaster.100
	title = cal_disaster.100.t
	desc = cal_disaster.100.d
	picture = RELIGIOUS_TURMOIL_eventPicture

	is_triggered_only = yes

	major = yes

	immediate = {
		#clear flags
	}

	option = { #atheist state victory
		name = cal_disaster.100.a
		trigger = {
			has_country_flag = cal_atheist_state
			NOT = { has_country_modifier = just_lost_to_rebels }
		}
		if = {
			limit = { NOT = { government = republic } }
			change_government_to_republic = yes
			add_government_reform = cal_atheist_republic_reform
		}
		add_prestige = 50
		if = {
			limit = {
				NOT = {
					stability = 2
				}
			}
			add_stability = 2
		}
		else = { add_republican_tradition = 20 }
	}

	option = { #caliphate victory
		trigger = {
			has_country_flag = cal_caliphate_fight
			NOT = { has_country_modifier = just_lost_to_rebels }
		}
		if = {
			limit = { NOT = { government = monarchy }}
			change_government_to_monarchy = yes
		}
		add_prestige = 50
		add_absolutism = 10
		if = {
			limit = {
				NOT = {
					stability = 2
				}
			}
			add_stability = 2
		}
		else = { add_legitimacy = 20 }
	}

	option = { #atheists lost
		trigger = {
			has_country_flag = cal_atheist_state
			has_country_modifier = just_lost_to_rebels
		}
		if = {
			limit = { NOT = { government = monarchy }}
			change_government_to_monarchy = yes
		}
	}

	option = { #caliphate lost
		trigger = {
			has_country_flag = cal_caliphate_fight
			has_country_modifier = just_lost_to_rebels
		}
		change_government_to_republic = yes
		add_government_reform = cal_atheist_republic_reform
	}
}
